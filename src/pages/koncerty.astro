---
import Layout from '../layouts/Layout.astro';
import { Image } from 'astro:assets';
import fs from 'node:fs';

const imageDir = 'public/images/subsites/concert';
let images = [];
try {
	const imageFiles = fs.readdirSync(imageDir).filter(file => /\.(jpg|jpeg|png|webp|avif|gif)$/i.test(file));
	images = imageFiles.map(file => `/images/subsites/concert/${file}`);
} catch (e) {
	console.error(`Nie można odczytać katalogu: ${imageDir}. Upewnij się, że istnieje i zawiera zdjęcia.`);
}
---

<Layout title="Koncerty | Aleksander Fijał">
    <div class="bg-black min-h-screen relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-48 bg-gradient-to-b from-black to-transparent z-20 pointer-events-none"></div>
        <div class="absolute top-[-20%] right-[-10%] w-[800px] h-[800px] bg-[#00f0ff]/10 rounded-full blur-[128px] pointer-events-none animate-blob"></div>
        <div class="absolute inset-0 bg-[linear-gradient(to_right,rgba(255,255,255,0.12)_1px,transparent_1px),linear-gradient(to_bottom,rgba(255,255,255,0.12)_1px,transparent_1px)] bg-[size:4rem_4rem] pointer-events-none"></div>
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,transparent_40%,#000000_98%)] pointer-events-none"></div>

        <section class="relative z-10 pt-32 pb-20 max-w-[1400px] mx-auto px-6">
            <div class="mb-20">
                <a href="/#portfolio" class="inline-block text-zinc-500 hover:text-[#00f0ff] font-mono text-xs uppercase tracking-widest transition-colors mb-6">← Powrót do Portfolio</a>
                <h1 class="font-black text-6xl md:text-9xl text-white uppercase tracking-tighter leading-none relative">
                    <span class="absolute inset-0 text-transparent bg-clip-text bg-gradient-to-r from-[#00f0ff] via-[#f2ff00] to-[#00f0ff] animate-gradient blur-xl opacity-50 select-none" aria-hidden="true">Koncerty</span>
                    <span class="relative text-transparent bg-clip-text bg-gradient-to-r from-[#00f0ff] via-[#f2ff00] to-[#00f0ff] animate-gradient">Koncerty</span>
                </h1>
            </div>

            <div class="masonry-grid -mx-3">
                <div class="masonry-sizer w-full sm:w-1/2 lg:w-1/3"></div>
                {images.map((imgSrc) => (
                    <div class="masonry-item w-full sm:w-1/2 lg:w-1/3 p-3">
                        <a href={imgSrc} class="lightbox-trigger group block relative overflow-hidden rounded-lg border border-white/10 bg-zinc-900 transition-all duration-500 hover:border-[#00f0ff]/50 cursor-pointer">
                            <Image 
                                src={imgSrc} 
                                alt="Zdjęcie koncertowe"
                                class="w-full h-auto transition-transform duration-700 ease-in-out group-hover:scale-105"
                                width={600}
                                height={800}
                            />
                        </a>
                    </div>
                ))}
            </div>
        </section>
    </div>
</Layout>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Archivo+Black&display=swap');
    h1 { font-family: 'Archivo Black', sans-serif; }
    .font-mono { font-family: 'JetBrains Mono', monospace; }
    .animate-gradient {
        background-size: 200% auto;
        animation: gradient 4s linear infinite;
    }
    @keyframes gradient {
        to { background-position: 200% center; }
    }
    .animate-blob {
        animation: blob 10s infinite;
    }
    @keyframes blob {
        0% { transform: translate(0px, 0px) scale(1); }
        33% { transform: translate(30px, -50px) scale(1.1); }
        66% { transform: translate(-20px, 20px) scale(0.9); }
        100% { transform: translate(0px, 0px) scale(1); }
    }
</style>

<script>
    import Masonry from 'masonry-layout';
    import imagesLoaded from 'imagesloaded';

    const grid = document.querySelector('.masonry-grid');
    if (grid) {
        imagesLoaded(grid, () => {
            new Masonry(grid, {
                itemSelector: '.masonry-item',
                columnWidth: '.masonry-sizer',
                percentPosition: true
            });
        });
    }
</script>